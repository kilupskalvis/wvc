pre-commit:
  parallel: true
  commands:
    fmt-check:
      run: test -z "$(gofmt -l . 2>&1)" || (gofmt -l . && exit 1)
      glob: "*.go"
    vet:
      run: go vet ./...
    staticcheck:
      run: |
        if command -v staticcheck >/dev/null 2>&1; then
          staticcheck ./...
        elif [ -x ~/go/bin/staticcheck ]; then
          ~/go/bin/staticcheck ./...
        fi
    test:
      run: go test ./... -short
    mod-tidy:
      run: |
        cp go.mod go.mod.bak
        go mod tidy
        diff -q go.mod go.mod.bak > /dev/null 2>&1
        result=$?
        rm go.mod.bak
        if [ $result -ne 0 ]; then
          echo "go.mod is not tidy. Run 'go mod tidy'"
          exit 1
        fi
